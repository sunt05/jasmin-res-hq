# Session: 2026-01-01 (JASMIN)

**Issue**: [[PER-393]] / [[PER-394]]

## Key Lesson Learned: CEDA Dataset Availability

**IMPORTANT FOR FUTURE RESEARCH DESIGN:**

CEDA/JASMIN only mirrors a **limited subset** of ERA5 variables. Before designing extraction workflows that rely on CEDA data, always verify variable availability first.

### What's Available on CEDA (`/badc/ecmwf-era5/`)

**an_sfc (analysis surface):**
- 2t, 2d (temperature, dewpoint) ✓
- 10u, 10v (wind) ✓
- msl (mean sea level pressure) ✓
- skt, cape, tcc, tcwv, ci, sd, sst, asn ✓

**fc_sfc (forecast surface) - ONLY 6 VARIABLES:**
- metss, mntss (turbulent stress)
- mslhf, msshf (heat fluxes)
- msnlwrf, msnswrf (radiation fluxes)

### What's NOT Available on CEDA

| Variable | Description | Alternative |
|----------|-------------|-------------|
| **tp** | Total precipitation | CDS API download |
| **sp** | Surface pressure | Use `msl` instead |
| **ssrd** | Surface solar radiation | CDS API download |
| **strd** | Surface thermal radiation | CDS API download |

### Recommendation for Future Tasks

1. **Check CEDA catalogue first**: https://catalogue.ceda.ac.uk
2. **Verify file existence**: `ls /badc/ecmwf-era5/data/oper/an_sfc/2020/01/01/*.{var}.nc`
3. **For missing variables**: Use CDS API (`~/.cdsapirc` configured)
4. **Consider ERA5-Land**: Higher resolution (9km) for some surface variables

Source: [CEDA ERA5 Surface Forecast Dataset](https://catalogue.ceda.ac.uk/uuid/3e7ad71f09c244318f9bddf92e5fcc4b/)

---

## Completed This Session

- [x] ERA5 extraction for 1990-1993 (4 years, 882 cities, 5 variables)
- [x] Fixed sp→msl (sp not on CEDA)
- [x] Synced to UCL Dropbox (3,528 files, 855 MB)
- [x] Fixed `~/.bash_profile` Lmod errors (old Intel modules)
- [x] Confirmed tp (precipitation) requires CDS download

## Data Produced

```
outputs/era5/
├── era5_{year}_{city_id}_{city_name}.nc
├── 1990-1993: 3,528 files (855 MB)
└── Variables: t2m, d2m, u10, v10, msl
```

Synced to: `dropbox-ucl:Data-JASMIN/era5-cities/`

## Performance Notes

- 1990s ERA5 data: ~110 min/year (~9 min/month)
- 2020s ERA5 data: ~65-90 min/year (~5-7 min/month)
- Older data ~40% slower (less cached, possibly different storage tier)

## For Next Session

1. **If more years needed**: Resume extraction for 1994-2023
   ```bash
   uv run python 20251231-hw-er-pilot/scripts/extract_era5_batch.py \
       --years 1994-2023 --variables 2t 2d 10u 10v msl
   ```

2. **For precipitation (tp)**: Use CDS API directly
   - Download for 882 city points (not global grids)
   - `~/.cdsapirc` already configured

3. **Consider multiprocessing**: For 1990-2023 full run, add parallel file reads

## Files Changed

- `20251231-hw-er-pilot/scripts/extract_era5_batch.py` - Fixed sp→msl, updated VAR_MAP
- `~/.bash_profile` - Commented out old Intel module loads
- `outputs/era5/` - 3,528 city files (not in git)
